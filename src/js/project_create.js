"use strict";$(document).ready(function(){var t=""===$("#contractContent").text().trim()?[]:JSON.parse($("#contractContent").text().trim()),e=""!==$("#projectData").text().trim()&&JSON.parse($("#projectData").text().trim()),n=function(t){var e={},n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;e[s.id]=s.name}}catch(t){r=!0,a=t}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return e}(t),r=function(t){var e={},n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;e[s.id]=s.rate}}catch(t){r=!0,a=t}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return e}(t);!function(t){var e={},n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;e[s.name]=s.id}}catch(t){r=!0,a=t}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}}(t),new Vue({el:"#projectCreate",data:{project:_schemas.projects,contractContent:t,TaxIDMap:r,ContentIDMap:n,checkedMen:[],menList:[],selectData:{id:""}},mounted:function(){e&&(this.project=_helper.projectGetFormat(e)),$("#projectCreate").removeClass("invisible")},computed:{sumAmount:function(){var t=this.project.masterContract,e=this.project.subContract,n=0,r=[];function a(t,e){if(e.length<1)return!1;e.forEach(function(e,a){var o=new BigNumber(e.amount?e.amount:0);n=o.plus(n),r.push({head:0===a,id:t+e.id,amount:o.toLocaleString("en-US"),type:t})})}return a("m",t),a("s",e),{sum:n.toLocaleString("en-US"),result:r}},sumContent:function(){var t=this.project.masterContract,e=this.project.subContract,n=0,r={},a=[];if(t&&e){c(t),c(e);for(var o in r){var i=this.ContentIDMap[o],s=this.TaxIDMap[o];a.push({name:i,tax:s,amount:r[o]})}return{sum:n,result:a}}function c(t){t.forEach(function(t,e){var a=t.details;if(!a||a.length<1)return!1;a.forEach(function(t,e){var a=new BigNumber(t.amount?t.amount:0);if(n=a.plus(n),void 0!==t.name){var o=t.name;r[o]=r[o]?r[o]+a:a}})})}},sumMargins:function(){var t=this.project.margins,e={sumGuaranteeAmount:new BigNumber(0),sumGuaranteeCost:new BigNumber(0),sumPaymentCost:new BigNumber(0)};return t.length<1?e:(t.forEach(function(t,n){e.sumGuaranteeAmount=e.sumGuaranteeAmount.plus(t.guarantee_amount||0),e.sumGuaranteeCost=e.sumGuaranteeCost.plus(t.guarantee_cost||0),e.sumPaymentCost=e.sumPaymentCost.plus(t.payment_amount||0)}),e)},sumPaymentConditions:function(){var t=this.project.paymentConditions,e=new BigNumber(0);return t.length<1?e:(t.forEach(function(t,n){e=e.plus(t.expected||0)}),e)}},methods:{addFirstItem:function(t){var e=this.project[t],n=e.length,r=void 0;r=n>0?e[n-1].id+1:1,"masterContract"===t||"subContract"===t?this.project[t].push({id:r,details:new Array}):this.project[t].push({id:r})},deleteFirstItem:function(t,e,n){this.project[t].splice(n,1)},addSecondItem:function(t,e){var n=this.project[t][e].details||[],r=n.length,a=void 0;a=r>0?n[r-1].id+1:1,this.project[t][e].details.push({id:a})},deleteSecondItem:function(t,e,n,r){this.project[t][e].details.splice(n,1)},fileUpload:function(t){var e=this,n=t.target.files,r=!0,a=!1,o=void 0;try{for(var i,s=n[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value,u=new FormData;u.append("image",c),_http.UploadManager.createUpload(u).then(function(t){if("200"===t.data.code){var n=t.data.data;e.project.contracts.push({id:n.size,name:n.name,url:n.url}),e.$notify({title:"成功",message:n.name+" 提交成功",type:"success"})}else e.$notify({title:"错误",message:t.data.msg,type:"error"})}).catch(function(t){e.$notify({title:"错误",message:"服务器出错",type:"error"})})}}catch(t){a=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}},submit:function(){var t=this,e=_helper.projectCreatFormat(this.project,n,r);_http.ProjectManager.createProject(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"提交成功",type:"success"}),setTimeout(function(){window.close()},300)):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(t){console.log(this.checkedMen)},confirmRecheck:function(){var t=this,e=this.selectData;e.users=this.checkedMen,_http.ProjectManager.selectProjectCheck(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
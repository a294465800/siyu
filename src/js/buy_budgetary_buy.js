"use strict";$(document).ready(function(){new Vue({el:"#budgetaryBuy",data:{budgetary_buy:_schemas.budgetary_buy,invoiceType:[],materials:[],checkedMen:[],menList:[{id:1,name:"张先生"},{id:2,name:"陈一发"},{id:3,name:"刘芳芳"},{id:4,name:"乌达奇"},{id:5,name:"何求"}],throttle:{supplier_timer:null}},mounted:function(){this.budgetary_buy.info.date=_helper.timeFormat(new Date,"YYYY-MM-DD");var e=$("#invoiceType").text().trim();this.invoiceType=""===e?[]:JSON.parse(e);var t=$("#materials").text().trim();this.materials=""===t?[]:JSON.parse(t),this.budgetary_buy.project_id=$("#projectId").val(),$("#budgetaryBuy").removeClass("invisible")},computed:{materialsComputed:function(){if(this.materials.length<1)return[];if(this.budgetary_buy.lists.length<1){var e=JSON.stringify(this.materials);return JSON.parse(e)}var t=JSON.stringify(this.materials),a=JSON.parse(t),i=this.budgetary_buy.lists,r=0;for(var n in i){var s=i[n],u=s.material;if(void 0===s.number)break;r+=parseFloat(s.cost||0),a[u.index].need_number-=parseInt(s.number||0)}return this.budgetary_buy.amount=r||0,a}},methods:{handleSelectSupplier:function(e){this.extrabudgetary.info.supplier_id=e.id,this.extrabudgetary.info.supplier_name=e.name,this.extrabudgetary.info.bank=e.bank,this.extrabudgetary.info.account=e.account},querySearchSupplier:function(e,t){var a=this;this.throttle.supplier_timer&&clearTimeout(this.throttle.supplier_timer),this.throttle.supplier_timer=setTimeout(function(){var i={name:e};_http.SupplierManager.searchSuppliers(i).then(function(e){"200"===e.data.code?t(e.data.data):a.$notify({title:"错误",message:e.data.msg||"未知错误",type:"error"})}).catch(function(e){a.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},addMaterial:function(e,t){var a=this.budgetary_buy.lists,i={own_id:a.length>0&&a[a.length-1].own_id?a[a.length-1].own_id+1:1,material:e,material_id:e.id};i.material.index=t,this.budgetary_buy.lists.push(i)},deleteItem:function(e,t,a){this.budgetary_buy[e].splice(a,1)},uploadContract:function(e){var t=this,a=e.target.files;if(!(a.length<1)){var i=!0,r=!1,n=void 0;try{for(var s,u=a[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var o=s.value,d=new FormData;d.append("image",o),_http.UploadManager.createUpload(d).then(function(e){if("200"===e.data.code){var a=e.data.data;t.budgetary_buy.contracts.push({id:a.size,name:a.name,href:a.url}),t.$notify({title:"成功",message:a.name+" 上传成功",type:"success"})}else t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}catch(e){r=!0,n=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw n}}}},submitForm:function(){var e=this;_http.BuyManager.createPurchase(this.budgetary_buy).then(function(t){"200"===t.data.code?(e.$notify.success({title:"成功",message:"提交成功！"}),$(".ui.dimmer").addClass("active")):e.$notify({title:"错误",message:t.data.msg,type:"error"})}).catch(function(t){e.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(e){console.log(this.checkedMen)},confirmRecheck:function(){this.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")}}})});
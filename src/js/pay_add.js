"use strict";$(document).ready(function(){new Vue({el:"#payAdd",data:{payForm:{apply_date:"",apply_price:"",application:"",project_id:"",project_content:"",pay_detail:"",pictures:[]},checkedMen:[],menList:[],throttle:{id_timer:null,name_timer:null,payee_timer:null},selectData:{id:""},currentSupplier:{},invoiceType:[],payType:[],pay_type:"",payDetail:[]},mounted:function(){var t=this;this.payForm.apply_date=_helper.timeFormat(new Date,"YYYY-MM-DD");var e=$("#invoiceType").text().trim();this.invoiceType=""===e?[]:JSON.parse(e),$("#payAdd").removeClass("invisible"),_http.PaymentManager.searchFeePay().then(function(e){"200"===e.data.code?t.payType=e.data.data:t.$notify({title:"错误",message:e.data.msg,type:"error"})});var a=$("#addEdit").text().trim();a&&(this.payForm=""===a?[]:JSON.parse(a),this.currentSupplier=this.payForm.currentSupplier,this.handlePayTypeChange(this.payForm.pay_type))},methods:{handlePayTypeChange:function(t){var e=this;this.payForm.pay_type=t,_http.PaymentManager.searchFeePayDetail({id:t}).then(function(t){"200"===t.data.code?e.payDetail=t.data.data:e.$notify({title:"错误",message:t.data.msg,type:"error"})})},querySearchProjectId:function(t,e){var a=this;clearTimeout(this.throttle.id_timer),this.throttle.id_timer=setTimeout(function(){var r={id:t,type:"pay_add"};_http.ProjectManager.searchProject(r).then(function(t){"200"===t.data.code?e(t.data.data):a.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){a.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectId:function(t){this.payForm.project_id=t.id,this.payForm.project_number=t.number,this.payForm.project_content=t.name},querySearchProjectContent:function(t,e){var a=this;clearTimeout(this.throttle.name_timer),this.throttle.name_timer=setTimeout(function(){var r={name:t};_http.ProjectManager.searchProject(r).then(function(t){"200"===t.data.code?e(t.data.data):a.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){a.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectContent:function(t){this.payForm.project_id=t.id,this.payForm.project_number=t.number,this.payForm.project_content=t.name},querySearchPayee:function(t,e){var a=this;clearTimeout(this.throttle.payee_timer),this.throttle.payee_timer=setTimeout(function(){var r={name:t};_http.SupplierManager.searchSuppliers(r).then(function(t){"200"===t.data.code?e(t.data.data):a.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){a.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectPayee:function(t){this.currentSupplier=t,this.payForm.supplier_id=t.id,this.payForm.payee=t.name},uploadContract:function(t){var e=this,a=t.target.files;if(!(a.length<1)){var r=!0,i=!1,n=void 0;try{for(var o,s=a[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,p=new FormData;p.append("image",c),_http.UploadManager.createUpload(p).then(function(t){if("200"===t.data.code){var a=t.data.data;e.payForm.pictures.push({id:a.size,name:a.name,url:a.url}),e.$notify({title:"成功",message:a.name+" 上传成功",type:"success"})}else e.$notify({title:"错误",message:t.data.msg,type:"error"})}).catch(function(t){console.log(t),e.$notify({title:"错误",message:"服务器出错",type:"error"})})}}catch(t){i=!0,n=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw n}}}},deleteItem:function(t){this.payForm.pictures.splice(t,1)},submit:function(){var t=this;_http.PaymentManager.createNewPayAdd(this.payForm).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"提交成功",type:"success"}),t.selectData.id=e.data.data.id,_http.UserManager.searchAuthUsers({role:"pay_pass"}).then(function(a){"200"===a.data.code?(t.menList=a.data.data,$(".ui.dimmer").addClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})})):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(t){console.log(this.checkedMen)},confirmRecheck:function(){var t=this;this.selectData.users=this.checkedMen,_http.PaymentManager.selectPay(this.selectData).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"已选择了审批人",type:"success"}),$(".ui.dimmer").removeClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
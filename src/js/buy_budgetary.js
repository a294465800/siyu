"use strict";$(document).ready(function(){new Vue({el:"#buyBudgetary",data:{project:{content:"",id:""},materialType:_schemas.budget_type_reverse,preMaterialsList:[],materialsDialog:!1,loader:!0,currentMaterial:{},materialsDetail:[],throttle:{project_id_timer:null,project_content_timer:null}},mounted:function(){$("#buyBudgetary").removeClass("invisible")},computed:{amountCost:function(){var t=this.preMaterialsList,e={count1:0,count2:0,count3:0};return t.lenght&&t.forEach(function(t,r){e.count1+=t.cost,e.count2+=t.buy_number*t.price,e.count3+=t.need_buy*t.price}),e},singleCost:function(){var t=this.materialsDetail,e={number:0,amount:0},r=0,a=0;return t.lenght&&(t.forEach(function(t,e){r+=t.number,a+=parseFloat(t.cost)*t.price}),e.number=this.currentMaterial.number-r,e.amount=this.currentMaterial.number*this.currentMaterial.price-a),e}},methods:{querySearch:function(t,e){var r=this;this.throttle.project_content_timer&&clearTimeout(this.throttle.project_content_timer),this.throttle.project_content_timer=setTimeout(function(){var a={name:t};_http.ProjectManager.searchProject(a).then(function(t){"200"===t.data.code?e(t.data.data):r.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){r.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelect:function(t){this.project.id=t.number,this.project.project_id=t.id,this.project.content=t.name},querySearchProjectId:function(t,e){var r=this;this.throttle.project_id_timer&&clearTimeout(this.throttle.project_id_timer),this.throttle.project_id_timer=setTimeout(function(){var a={id:t};_http.ProjectManager.searchProject(a).then(function(t){"200"===t.data.code?e(t.data.data):r.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){r.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectId:function(t){this.project.id=t.number,this.project.project_id=t.id,this.project.content=t.name,this.searchMaterials()},searchMaterials:function(){var t=this;_http.MaterialManager.searchBudgetMaterial(this.project.id,{}).then(function(e){"200"===e.data.code?t.preMaterialsList=e.data.data:t.$notify({title:"错误",message:e.data.msg||"未知错误",type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},checkDetail:function(t,e){var r=this;this.loader=!0,this.materialsDialog=!0,this.currentMaterial=t,_http.MaterialManager.searchPurchase(t.id).then(function(t){"200"===t.data.code?(r.materialsDetail=t.data.data,r.loader=!1):r.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){r.$notify({title:"错误",message:"服务器出错",type:"error"})})},submit:function(){if(!this.project.id||!this.project.content)return!1;_helper.fullWindow("../buy/budgetary_buy?id="+this.project.project_id)}}})});
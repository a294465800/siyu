"use strict";$(document).ready(function(){new Vue({el:"#loanSubmitOther",data:{submitProjectForm:{loan_user:"",date:"",price:"",project_id:"",project_content:"",lists:[]},paymentData:{currentTypeIndex:"",currentType:{},typeList:[],currentDetailTypeIndex:"",currentDetailType:{},detailTypeList:[]},checkedMen:[],menList:[],selectData:{id:""},throttle:{project_id_timer:null,project_content_timer:null}},mounted:function(){var t=this;_http.LoanManager.searchCategory().then(function(e){"200"===e.data.code?t.paymentData.typeList=e.data.data:t.$notify({title:"错误",message:e.data.msg||"未知错误",type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})}),this.submitProjectForm.price=$("#topAmount").val(),this.submitProjectForm.date=$("#date").val()||_helper.timeFormat(new Date,"YYYY-MM-DD"),this.submitProjectForm.loan_user=$("#loanUser").val(),this.submitProjectForm.project_id=$("#projectId").val(),this.submitProjectForm.project_number=$("#projectNumber").val(),this.submitProjectForm.project_content=$("#projectContent").val(),$("#loanSubmitOther").removeClass("invisible")},computed:{sumAmount:function(){var t=this.submitProjectForm.lists;if(!t.length)return 0;var e=0;return t.forEach(function(t,r){var i=t.price;i&&(e+=1*i)}),e}},methods:{querySearchProjectId:function(t,e){var r=this;this.throttle.project_id_timer&&clearTimeout(this.throttle.project_id_timer),this.throttle.project_id_timer=setTimeout(function(){var i={id:t};_http.ProjectManager.searchProject(i).then(function(t){"200"===t.data.code?e(t.data.data):r.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){r.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectId:function(t){this.submitProjectForm.project_id=t.id,this.submitProjectForm.project_number=t.number,this.submitProjectForm.project_content=t.name},querySearchProjectContent:function(t,e){var r=this;this.throttle.project_content_timer&&clearTimeout(this.throttle.project_content_timer),this.throttle.project_content_timer=setTimeout(function(){var i={name:t};_http.ProjectManager.searchProject(i).then(function(t){"200"===t.data.code?e(t.data.data):r.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){r.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectContent:function(t){this.submitProjectForm.project_id=t.id,this.submitProjectForm.project_number=t.number,this.submitProjectForm.project_content=t.name},addItem:function(){var t=this.paymentData.currentType.id,e=this.paymentData.currentDetailType.id;if(""!==t){var r=this.submitProjectForm.lists,i={id:r.length>0&&r[r.length-1].id?r[r.length-1].id+1:1,kind_id:e,category_id:t,type:this.paymentData.currentType.title,detailType:this.paymentData.currentDetailType.title};this.submitProjectForm.lists.push(i)}else this.$notify({title:"错误",message:"请先选择具体事项",type:"error"})},deleteItem:function(t,e,r){this.submitProjectForm[t].splice(r,1)},typeChange:function(t){var e=this.paymentData.typeList[t];this.paymentData.currentType=e,this.paymentData.currentDetailTypeIndex="",this.paymentData.detailTypeList=e.kinds.length?e.kinds:[]},detailTypeChange:function(t){var e=this.paymentData.detailTypeList[t];this.paymentData.currentDetailType=e},formatData:function(t){for(var e={loan_user:t.loan_user,date:t.date,price:t.price,project_id:t.project_id,lists:[]},r=t.lists,i=0;i<r.length;i++){var a={category_id:r[i].category_id,kind_id:r[i].kind_id,remark:r[i].remark,number:r[i].number,price:r[i].price};e.lists.push(a)}return e},submit:function(){var t=this,e=this.formatData(this.submitProjectForm);console.log(e),_http.LoanManager.createSubmitProject(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"提交成功",type:"success"}),t.selectData.id=e.data.data.id,console.log("send"),_http.UserManager.searchAuthUsers({role:"loan_project_submit_check",project_id:t.submitProjectForm.project_id}).then(function(e){"200"===e.data.code?(t.menList=e.data.data,$(".ui.dimmer").addClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})})):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(t){console.log(this.checkedMen)},confirmRecheck:function(){var t=this,e=this.selectData;e.users=this.checkedMen,_http.LoanManager.selectCheckSubmit(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
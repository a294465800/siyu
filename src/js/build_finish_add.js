"use strict";$(document).ready(function(){new Vue({el:"#buildFinishAdd",data:{buildFinishAdd:_schemas.buildFinishAdd,build_teams:[],projects:[],checkedMen:[],menList:[],selectData:{id:""},throttle:{id_timer:null,name_timer:null,team_timer:null}},mounted:function(){$("#buildFinishAdd").removeClass("invisible"),this.buildFinishAdd.date=_helper.timeFormat(new Date,"YYYY-MM-DD")},computed:{sumAmount:function(){var t=this.buildFinishAdd.lists;if(!t.length)return 0;var e=0;return t.forEach(function(t,i){var n=t.total;n&&(e+=1*n)}),e}},methods:{querySearchBuild:function(t,e){var i=this;this.throttle.team_timer&&clearTimeout(this.throttle.team_timer),this.throttle.team_timer=setTimeout(function(){var n={id:t};_http.TeamManager.searchTeam(n).then(function(t){"200"===t.data.code?e(t.data.data):i.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){i.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectBuild:function(t){this.buildFinishAdd.team=t.id,this.buildFinishAdd.build_name=t.name,this.buildFinishAdd.build_manager=t.manager},querySearchProjectId:function(t,e){var i=this;this.throttle.id_timer&&clearTimeout(this.throttle.id_timer),this.throttle.id_timer=setTimeout(function(){var n={id:t};_http.ProjectManager.searchProject(n).then(function(t){"200"===t.data.code?e(t.data.data):i.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){i.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectId:function(t){this.payForm.project_id=t.number,this.payForm.project_content=t.name,this.buildFinishAdd.project_manager=t.pm},querySearchProjectContent:function(t,e){var i=this;this.throttle.name_timer&&clearTimeout(this.throttle.name_timer),this.throttle.name_timer=setTimeout(function(){var n={name:t};_http.ProjectManager.searchProject(n).then(function(t){"200"===t.data.code?e(t.data.data):i.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){i.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectProjectContent:function(t){this.buildFinishAdd.project_id=t.number,this.buildFinishAdd.project_content=t.name,this.buildFinishAdd.project_manager=t.pm},submit:function(){var t=this;console.log(this.buildFinishAdd),_http.TeamManager.createFinish(this.buildFinishAdd).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"提交成功",type:"success"}),t.selectData.id=e.data.data.id,_http.UserManager.searchAuthUsers({role:"build_finish_check"}).then(function(e){"200"===e.data.code?(t.menList=e.data.data,$(".ui.dimmer").addClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})})):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},addItem:function(){var t=this.buildFinishAdd.lists,e={id:t.length>0&&t[t.length-1].id?t[t.length-1].id+1:1};this.buildFinishAdd.lists.push(e)},deleteItem:function(t,e,i){this.buildFinishAdd[t].splice(i,1)},handleCheckManChange:function(t){console.log(this.checkedMen)},confirmRecheck:function(){var t=this,e=this.selectData;e.users=this.checkedMen,_http.TeamManager.selectFinishCheck(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
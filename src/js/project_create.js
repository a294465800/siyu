"use strict";$(document).ready(function(){var t=""===$("#contractContent").text().trim()?[]:JSON.parse($("#contractContent").text().trim()),e=""!==$("#projectData").text().trim()&&JSON.parse($("#projectData").text().trim()),a=function(t){var e={},a=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var c=o.value;e[c.id]=c.name}}catch(t){n=!0,r=t}finally{try{!a&&i.return&&i.return()}finally{if(n)throw r}}return e}(t),n=function(t){var e={},a=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var c=o.value;e[c.id]=c.rate}}catch(t){n=!0,r=t}finally{try{!a&&i.return&&i.return()}finally{if(n)throw r}}return e}(t);!function(t){var e={},a=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var c=o.value;e[c.name]=c.id}}catch(t){n=!0,r=t}finally{try{!a&&i.return&&i.return()}finally{if(n)throw r}}}(t),new Vue({el:"#projectCreate",data:{project:_schemas.projects,contractContent:t,TaxIDMap:n,ContentIDMap:a,checkedMen:[],menList:[],selectData:{id:""}},mounted:function(){e&&(this.project=_helper.projectGetFormat(e)),$("#projectCreate").removeClass("invisible")},watch:{project:function(t){console.log(t)}},computed:{sumAmount:function(){var t=this.project.masterContract,e=this.project.subContract,a=0,n=[];function r(t,e){if(e.length<1)return!1;e.forEach(function(e,r){var o=e.amount?parseFloat(e.amount):0;a+=o,n.push({head:0===r,id:t+e.id,amount:o.toLocaleString("en-US"),type:t})})}return r("m",t),r("s",e),{sum:a.toLocaleString("en-US"),result:n}},sumContent:function(){var t=this.project.masterContract,e=this.project.subContract,a=0,n={},r=[];if(t&&e){s(t),s(e);for(var o in n){var i=this.ContentIDMap[o],c=this.TaxIDMap[o];r.push({name:i,tax:c,amount:n[o]})}return{sum:a,result:r}}function s(t){t.forEach(function(t,e){var r=t.details;if(!r||r.length<1)return!1;r.forEach(function(t,e){var r=t.amount?parseFloat(t.amount):0;if(a+=r,void 0!==t.name){var o=t.name;n[o]=n[o]?n[o]+r:r}})})}},sumMargins:function(){var t=this.project.margins,e={sumGuaranteeAmount:0,sumGuaranteeCost:0,sumPaymentCost:0};return t.length<1?e:(t.forEach(function(t,a){e.sumGuaranteeAmount+=t.guarantee_amount?parseFloat(t.guarantee_amount):0,e.sumGuaranteeCost+=t.guarantee_cost?parseFloat(t.guarantee_cost):0,e.sumPaymentCost+=t.payment_amount?parseFloat(t.payment_amount):0}),e)},sumPaymentConditions:function(){var t=this.project.paymentConditions,e=0;return t.length<1?e:(t.forEach(function(t,a){e+=t.expected?parseFloat(t.expected):0}),e)}},methods:{addFirstItem:function(t){var e=this.project[t],a=e.length,n=void 0;n=a>0?e[a-1].id+1:1,"masterContract"===t||"subContract"===t?this.project[t].push({id:n,details:new Array}):this.project[t].push({id:n})},deleteFirstItem:function(t,e,a){this.project[t].splice(a,1)},addSecondItem:function(t,e){var a=this.project[t][e].details||[],n=a.length,r=void 0;r=n>0?a[n-1].id+1:1,this.project[t][e].details.push({id:r})},deleteSecondItem:function(t,e,a,n){this.project[t][e].details.splice(a,1)},fileUpload:function(t){var e=this,a=t.target.files,n=!0,r=!1,o=void 0;try{for(var i,c=a[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var s=i.value,u=new FormData;u.append("image",s),_http.UploadManager.createUpload(u).then(function(t){if("200"===t.data.code){var a=t.data.data;e.project.contracts.push({id:a.size,name:a.name,url:a.url}),e.$notify({title:"成功",message:a.name+" 提交成功",type:"success"})}else e.$notify({title:"错误",message:t.data.msg,type:"error"})}).catch(function(t){e.$notify({title:"错误",message:"服务器出错",type:"error"})})}}catch(t){r=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(r)throw o}}},submit:function(){var t=this,e=_helper.projectCreatFormat(this.project,a,n);_http.ProjectManager.createProject(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"提交成功",type:"success"}),setTimeout(function(){window.close()},300)):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(t){console.log(this.checkedMen)},confirmRecheck:function(){var t=this,e=this.selectData;e.users=this.checkedMen,_http.ProjectManager.selectProjectCheck(e).then(function(e){"200"===e.data.code?(t.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}$(document).ready(function(){new Vue({el:"#checkDetail",data:{current:{marginRecyle:-1,requirement:-1,invoice:-1,subCompany:-1,masterContract:-1,subContract:-1},editForm:{marginRecyle:{},requirement:{},invoice:{},subCompany:{},masterContract:{},subContract:{}},marginPay:{},marginRecyle:{},requirement:{},invoice:{},invoiceCompany:[],invoiceCompanyCopy:{},invoiceTax:[],subCompany:{},masterContract:{},subContract:{}},mounted:function(){function t(t){var e=t.length,i=[];return t.forEach(function(t,a){a>=e-1||i.push($(t).text())}),i}this.init(),this.invoiceCompanyCopy=this.copyData(this.invoiceCompany),console.log(this),$("#checkDetail").removeClass("invisible");var e=void 0;$(".margin-edit").on("click",function(){(e=$(this).parents("tr")).hide(),t(e.find("td"))}),$(".margin-save").on("click",function(){(e=$(this).parents("tr")).hide(),t(e.find("td"))})},computed:{marginCount:function(){if(!this.marginRecyle.data)return 0;var t=0;return this.marginRecyle.data.forEach(function(e,i){t+=e.realAmount}),t},preMarginCount:function(){if(!this.marginRecyle.data)return 0;var t=0;return this.marginRecyle.data.forEach(function(e,i){t+=e.preAmount}),t},leftMarginCount:function(){return this.preMarginCount-this.marginCount},requirementCount:function(){if(!this.requirement.data)return 0;var t=0;return this.requirement.data.forEach(function(e,i){t+=e.amount}),t},invoiceCount:function(){if(!this.invoice.data)return 0;var t=0;return this.invoice.data.forEach(function(e,i){t+=e.amount}),t},invoiceTaxCount:function(){if(!this.invoice.data)return[];var t=this.invoice.data,e={},i=new Array;t.forEach(function(t,i){var a=t.company.id,n=t.tax.id;e[a]?e[a][n]?e[a][n]+=t.amount:e[a][n]=t.amount:e[a]=new Object(_defineProperty({},n,t.amount))});for(var a in e){var n=new Object;n.company={id:a,name:this.invoiceCompanyCopy[a]},n.result=e[a],n.count=0;for(var r in e[a])n.count+=e[a][r];i.push(n)}return i},subCompanyCount:function(){if(!this.subCompany.data)return 0;var t=0;return this.subCompany.data.forEach(function(e,i){t+=e.amount}),t},masterContractCount:function(){if(!this.masterContract.data)return 0;var t=0;return this.masterContract.data.forEach(function(e,i){t+=e.amount}),t},subContractCount:function(){if(!this.subContract.data)return 0;var t=0;return this.subContract.data.forEach(function(e,i){t+=e.amount}),t}},methods:{init:function(){var t=$("#marginPay").text().trim();this.marginPay=""===t?{}:JSON.parse(t);var e=$("#marginRecyle").text().trim();this.marginRecyle=""===e?{}:JSON.parse(e);var i=$("#requirement").text().trim();this.requirement=""===i?{}:JSON.parse(i);var a=$("#invoice").text().trim();this.invoice=""===a?{}:JSON.parse(a);var n=$("#invoiceCompany").text().trim();this.invoiceCompany=""===n?{}:JSON.parse(n);var r=$("#invoiceTax").text().trim();this.invoiceTax=""===r?{}:JSON.parse(r);var o=$("#subCompany").text().trim();this.subCompany=""===o?{}:JSON.parse(o);var c=$("#masterContract").text().trim();this.masterContract=""===c?{}:JSON.parse(c);var s=$("#subContract").text().trim();this.subContract=""===s?{}:JSON.parse(s)},copyData:function(t){var e={};for(var i in t){var a=t[i].id,n=t[i].value;e[a]=n}return e},dataValidate:function(t){for(var e in t)if(""===t[e])return this.$notify.error({title:"错误",message:"请确保已填写所有项！"}),!1;return!0},EditFnc:function(t,e,i){this.editForm[i]=t,this.current[i]=e},marginRecyleSave:function(t,e){var i=this.editForm.marginRecyle;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.marginRecyle=-1)},requirementSave:function(t,e){var i=this.editForm.requirement;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.requirement=-1)},invoiceSave:function(t,e){var i=this.editForm.invoice;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.invoice=-1)},subCompanySave:function(t,e){var i=this.editForm.subCompany;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.subCompany=-1)},masterContractSave:function(t,e){var i=this.editForm.masterContract;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.masterContract=-1)},subContractSave:function(t,e){var i=this.editForm.subContract;this.dataValidate(i)&&(this.$notify.success({title:"成功",message:"已修改"}),this.current.subContract=-1)}}}),new Vue({el:"#projectCheckDialog",data:{currentType:"masterContract",centerDialogVisible:!1,map:{marginLeft:"预计回收",marginRight:"实际回收",finish:"预计请款",company:"发包公司",subContract:"分包合同",masterContract:"主合同"},unitMap:{marginLeft:"pay_unit",marginRight:"payee",finish:"pay_unit",company:"",subContract:"payee",masterContract:"payee"},marginLeft:{pay_date:"",price:"",pay_unit:"",remark:""},marginRight:{pay_date:"",price:"",payee:"",bank:"",account:""},finish:{pay_date:"",price:"",pay_unit:"",remark:""},company:{pay_date:"",remark:""},subContract:{payee:"",pay_date:"",price:"",bank:"",account:""},masterContract:{payee:"",pay_date:"",price:"",bank:"",account:""},throttle:{unit_timer:null,bank_timer:null},currentId:"",project_id:"",invoice:{data:[]}},mounted:function(){this.project_id=$("#projectId")||"";var t=this;$(".edit-btn").on("click",function(){var e=this,i=$(this),a=i.data("type"),n=i.data("id");t.currentId=n,t.currentType=a;var r="marginLeft"===a||"finish"===a?"getTip":"getCollect";_http.CheckManager[r]({id:n}).then(function(i){"200"===i.data.code?(t[a]=i.data.data,t.centerDialogVisible=!0):e.$notify({title:"错误",message:i.data.msg||"未知错误",type:"error"})}).catch(function(t){e.$notify({title:"错误",message:"服务器出错",type:"error"})})})},methods:{querySearchCompany:function(t,e){var i=this;this.throttle.unit_timer&&clearTimeout(this.throttle.unit_timer),this.throttle.unit_timer=setTimeout(function(){var a={payee:t,project_id:i.project_id||""};_http.ProjectManager.searchProjectUnit(a).then(function(t){"200"===t.data.code?e(t.data.data):i.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){i.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectCompany:function(t){var e=this.currentType;this[e][this.unitMap[e]]=t},querySearchBank:function(t,e){var i=this;this.throttle.bank_timer&&clearTimeout(this.throttle.bank_timer),this.throttle.bank_timer=setTimeout(function(){var a={name:t};_http.BankManager.searchBank(a).then(function(t){"200"===t.data.code?e(t.data.data):i.$notify({title:"错误",message:t.data.msg||"未知错误",type:"error"})}).catch(function(t){i.$notify({title:"错误",message:"服务器出错",type:"error"})})},500)},handleSelectBank:function(t){var e=this.currentType;this[e].bank=t.name,this[e].account=t.account},submit:function(){var t=this,e="marginLeft"===this.currentType||"finish"===this.currentType?"editTip":"editCollect",i=Object.assign({},{id:this.currentId},this[this.currentType]);_http.CheckManager[e](i).then(function(e){"200"===e.data.code?(t.$notify.success({title:"成功",message:"已修改"}),t.centerDialogVisible=!1):t.$notify({title:"错误",message:e.data.msg||"未知错误",type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}})});
"use strict";$(document).ready(function(){new Vue({el:"#budgetaryBuy",data:{budgetary_buy:_schemas.budgetary_buy,invoiceType:[],suppliers:[{id:1,name:"供货商一",bank:"中国银行",account:0xe15b73f9653300},{id:2,name:"供货商二",bank:"平安银行",account:0xe15b8b2ffa7800},{id:3,name:"供货商三",bank:"广发银行",account:0xe15b73ecdc46a0},{id:4,name:"供货商四",bank:"建设银行",account:0xe16d608f865d70}],materials:[{id:1,name:"物料一",parameter:"参数一",model:"型号一",manufacturer:"厂家一",unit:"个",price:253,quantity:2534,buy_number:1500,left_number:1034},{id:2,name:"物料二",parameter:"参数二",model:"型号二",manufacturer:"厂家二",unit:"件",price:2542,quantity:500,buy_number:300,left_number:200},{id:4,name:"物料三",parameter:"参数三",model:"型号三",manufacturer:"厂家三",unit:"间",price:123,quantity:5e3,buy_number:2300,left_number:2700},{id:3,name:"物料四",parameter:"参数四",model:"型号四",manufacturer:"厂家四",unit:"间",price:542,quantity:5e3,buy_number:5e3,left_number:0}],checkedMen:[],menList:[{id:1,name:"张先生"},{id:2,name:"陈一发"},{id:3,name:"刘芳芳"},{id:4,name:"乌达奇"},{id:5,name:"何求"}]},mounted:function(){this.budgetary_buy.info.date=_helper.timeFormat(new Date,"YYYY-MM-DD");var e=$("#invoiceType").text().trim();this.invoiceType=""===e?[]:JSON.parse(e),this.budgetary_buy.project_id=$("#projectId").val(),$("#budgetaryBuy").removeClass("invisible")},computed:{materialsComputed:function(){if(this.materials.length<1)return[];if(this.budgetary_buy.lists.length<1){var e=JSON.stringify(this.materials);return JSON.parse(e)}var t=JSON.stringify(this.materials),a=JSON.parse(t),i=this.budgetary_buy.lists,r=0;for(var n in i){var u=i[n],s=u.material;if(void 0===u.real_quantity)break;r+=parseFloat(u.real_amount||0),a[s.index].left_number-=parseInt(u.real_quantity||0)}return this.budgetary_buy.amount=r||0,a}},methods:{querySearchSupplier:function(e,t){var a=this.suppliers,i=e?a.filter(this.createFilterSupplier(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(i)},1e3*Math.random())},createFilterSupplier:function(e){return function(t){return 0===t.id.toLowerCase().indexOf(e.toLowerCase())}},handleSelectSupplier:function(e){this.budgetary_buy.supplier.id=e.id,this.budgetary_buy.supplier.name=e.name,this.budgetary_buy.supplier.bank=e.bank,this.budgetary_buy.supplier.account=e.account},addMaterial:function(e,t){var a=this.budgetary_buy.lists,i={id:a.length>0&&a[a.length-1].id?a[a.length-1].id+1:1,material:e};i.material.index=t,this.budgetary_buy.lists.push(i)},deleteItem:function(e,t,a){this.budgetary_buy[e].splice(a,1)},uploadContract:function(e){var t=this,a=e.target.files;if(!(a.length<1)){var i=!0,r=!1,n=void 0;try{for(var u,s=a[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value,m=new FormData;m.append("image",c),_http.UploadManager.createUpload(m).then(function(e){"200"===e.data.code?(e.data.data,t.budgetary_buy.contracts.push({id:resData.size,name:resData.name,href:resData.url}),t.$notify({title:"成功",message:resData.name+" 上传成功",type:"success"})):t.$notify({title:"错误",message:e.data.msg,type:"error"})}).catch(function(e){t.$notify({title:"错误",message:"服务器出错",type:"error"})})}}catch(e){r=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw n}}}},submitForm:function(){var e=this;_http.BuyManager.createPurchase(this.budgetary_buy).then(function(t){"200"===t.data.code?(e.$notify.success({title:"成功",message:"提交成功！"}),$(".ui.dimmer").addClass("active")):e.$notify({title:"错误",message:t.data.msg,type:"error"})}).catch(function(t){e.$notify({title:"错误",message:"服务器出错",type:"error"})})},handleCheckManChange:function(e){console.log(this.checkedMen)},confirmRecheck:function(){this.$notify({title:"成功",message:"已选择了复核人",type:"success"}),$(".ui.dimmer").removeClass("active")}}})});